<%= grid(@bills, hide_submit_button: true, hide_reset_button: true, show_filters: :when_filtered) do |g|

  g.column name: '案件号' do |bill|
    bill.main_case.case_no_display
  end

  g.column name: '发票类型' do |a|
    Bill::BILL_TYPE_MAP[a.bill_type.to_sym] if a.bill_type
  end

  g.column name: '公司名称', attribute: 'organization' do |a|
    a.organization
  end

  g.column name: '税号', attribute: 'code' do |a|
    a.code
  end

  g.column name: '开户行', attribute: 'bank' do |a|
    a.bank
  end

  g.column name: '公司地址', attribute: 'address' do |a|
    a.address
  end

  g.column name: '发票金额', attribute: 'amount' do |a|
    a.amount
  end

  g.column name: '发票状态' do |a|
    Bill::BILL_STAGE_MAP[a.bill_stage.to_sym]
  end

  g.column name: '领取信息' do |bill|
    "已领取，#{bill.recipient}, #{bill.recipient_date.strftime('%Y年%m月%d日')}" if bill.taked_away?
  end

  g.column in_csv: false do |bill|
    if can?('bills', 'to_billed')  && !bill.billed? && !bill.taked_away?
      link_to '已开票', to_billed_main_case_bill_path(bill.main_case, bill), method: :patch, class: 'btn btn-info btn-sm'
    end
  end

  g.column in_csv: false do |bill|
    if can?('bills', 'to_taked_away') && !bill.taked_away?
      link_to '已领走', dyn_form_modal_main_case_bill_path(bill.main_case, bill, come_from: 'ensure_bill'), method: :post, remote: true, class: 'btn btn-primary btn-sm'
    end
  end

  g.column in_csv: false do |bill|
    if can?('bills', 'update') && bill.unBilled?
      link_to '编辑', dyn_form_modal_main_case_bill_path(@main_case, bill), method: :post, remote: true, class: 'btn btn-primary btn-sm'
    end
  end

  g.column in_csv: false do |bill|
    if can?('bills', 'destroy') && bill.unBilled?
      link_to '删除', main_case_bill_path(bill.main_case, bill), method: :delete, data: { confirm: '确定删除么?' }, class: 'btn btn-danger btn-sm'
    end
  end

end -%>