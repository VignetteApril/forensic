<%= define_grid(@main_cases, hide_submit_button: true, hide_reset_button: true) do |g|
  g.column name: '条码' do |main_case|
    if main_case.barcode_image.attached?
      link_to open_barcode_image_main_cases_path(main_case_id: main_case.id), remote: true do
        image_tag("barcode.png", alt: "条码", style: 'height: 35px; width: auto;')
      end
    end
  end

  g.column name: '流水号', attribute: 'serial_no', detach_with_id: :serial_no_filter, ordering: false do |main_case|
    main_case.serial_no
  end

  g.column name: '案号', attribute: 'case_no_display', detach_with_id: :case_no_display_filter, ordering: false do |main_case|
    main_case.case_no_display
  end

  g.column name: '委托方', attribute: 'organization_name', detach_with_id: :organization_name_filter, ordering: false do |main_case|
    main_case.organization_name
  end

  g.column name: '联系人', attribute: 'user_name', detach_with_id: :user_name_filter, ordering: false do |main_case|
    main_case.user_name
  end

  g.column name: '联系方式', attribute: 'organization_phone', filter: false, ordering: false do |main_case|
    main_case.organization_phone
  end

  g.column name: '被鉴定人', attribute: 'name', assoc: :appraised_unit, detach_with_id: :appraised_unit_name_filter, ordering: false do |main_case|
    main_case.appraised_unit.name
  end

  g.column name: '鉴定事项', attribute: 'matter', filter: false, ordering: false do |main_case|
    JSON.parse(main_case.matter).join(',') unless main_case.matter.blank?
  end

  g.column name: '受委托部门', attribute: 'name', assoc: :department, detach_with_id: :department_name_filter,
  custom_filter: department_collection, allow_multiple_selection: false, ordering: false do |main_case|
    main_case.department.name
  end

  g.column name: '案件状态', attribute: 'case_stage', detach_with_id: :case_stage_filter, custom_filter: case_stages_collection,
  allow_multiple_selection: false, ordering: false do |main_case|
    MainCase::CASE_STAGE_MAP[main_case.case_stage.to_sym]
  end

  g.column name: '付款状态', attribute: 'financial_stage', detach_with_id: :financial_stage_filter, custom_filter: financial_stage_collection,
   allow_multiple_selection: false, ordering: false do |main_case|
    MainCase::FINANCIAL_STAGE_MAP[main_case.financial_stage.to_sym]
  end

  g.column name: '经办人', attribute: 'pass_user',  detach_with_id: :pass_user_filter, ordering: false do |main_case|
    main_case.pass_user
  end

  g.column name: '结案倒计时', attribute: 'commission_date', filter: false, ordering: false do |main_case|
    distance_of_time_in_words(Date.today, main_case.commission_date) if main_case.commission_date
  end

  g.column in_csv: false, html: {style: "width:15px;"}  do |main_case|
    link_to '编辑', edit_main_case_path(main_case), class: 'btn btn-secondary btn-sm'
  end

  g.column in_csv: false, html: {style: "width:15px;"}  do |main_case|
    link_to '删除', main_case, method: :delete, data: { confirm: '确定删除么?' }, class: 'btn btn-danger btn-sm'
  end
end -%>